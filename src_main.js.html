

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: src/main.js | Source: src/main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 120px; height: 15px">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Source: src/main.js</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-Interfaz.html">Interfaz</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Interfaz_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="DibujarGrafo.html">DibujarGrafo</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DibujarGrafo_sub"></div></li><li><a href="Grafo.html">Grafo</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Grafo_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Grafo.html#getNodos">getNodos</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Grafo.html#agregarAristaDirigida">agregarAristaDirigida</a></li><li><a href="Grafo.html#agregarAristaNoDirigida">agregarAristaNoDirigida</a></li><li><a href="Grafo.html#agregarNodo">agregarNodo</a></li><li><a href="Grafo.html#getNodoPorKey">getNodoPorKey</a></li><li><a href="Grafo.html#matrizAdyacencia">matrizAdyacencia</a></li><li><a href="Grafo.html#prim">prim</a></li></ul></div></li><li><a href="Nodo.html">Nodo</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Nodo_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Nodo.html#agregarVecino">agregarVecino</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import DibujarGrafo from '../library/DibujarGrafo.js';
import Grafo from '../library/Grafo.js';
import '../styles/style.css';


//Variables globales
let dibujoGrafo = new DibujarGrafo('graph');
const nodosParaRutaMasCorta = [];
const dibujarNodosSeleccionados = [];
let grafo = new Grafo();
let seguidoresOwner = [];
let owner = {};
let aristas = 0;

document.addEventListener('DOMContentLoaded',  () => {
  initApp()
})

function initApp() {
  //AÃ±ade los eventos en botones necesarios para que funciona la app
  const botonRutaMasCorta = document.querySelector('.ruta-mas-corta');
  botonRutaMasCorta.addEventListener('click', () => {
    // botonRutaMasCorta.style.backgroundColor = 'yellow';
    if(nodosParaRutaMasCorta.length === 2) {
      const data =   rutaMasCorta(nodosParaRutaMasCorta[0], nodosParaRutaMasCorta[1]);
      nodosParaRutaMasCorta.length = 0;
      dibujarNodosSeleccionados.length = 0;
      const complejidadTextoRmc = document.querySelector('.rmc-complejidad');
      complejidadTextoRmc.textContent = (seguidoresOwner.length + 1) * aristas;
      const complejidadTextoPrim = document.querySelector('.prim-complejidad');
      complejidadTextoPrim.textContent = 'Aristas * log(Vertices)';
      pintarAzul();
      llenarAristas(data);
    } else {
      const mensajeError =  document.querySelector('.rmc-error');
      if(mensajeError.style.display === 'none' || mensajeError.style.display === '') {
        mensajeError.style.display = 'block';
        setTimeout(() => {
          mensajeError.style.display = 'none';
        }, 3000);        
      }
    }
  });

  const botonArbolExpMin = document.querySelector('.arbol-minimo-prim');
  botonArbolExpMin.addEventListener('click', () => {
    // botonArbolExpMin.style.backgroundColor = 'yellow';
    if(nodosParaRutaMasCorta.length === 1){
      const resultados = arbolExpMin(nodosParaRutaMasCorta[0]);
      nodosParaRutaMasCorta.length = 0;
      dibujarNodosSeleccionados.length = 0;
      const complejidadTextoPrim = document.querySelector('.prim-complejidad');
      complejidadTextoPrim.textContent = Math.round(aristas * Math.log10(seguidoresOwner.length + 1) * 100) /100;
      const complejidadTextoRmc = document.querySelector('.rmc-complejidad');
      complejidadTextoRmc.textContent = 'Vertices * Aristas';
      pintarAzul();
      llenarAristasPrim(resultados);
    } else {
      const mensajeError =  document.querySelector('.prim-error');
      if(mensajeError.style.display === 'none' || mensajeError.style.display === '') {
        mensajeError.style.display = 'block';
        setTimeout(() => {
          mensajeError.style.display = 'none';
        }, 3000);        
      }
    }
  });
  const botonCrearGrafo = document.querySelector('.obtener-data');
  botonCrearGrafo.addEventListener('click', async () => {
    const resultado = new DibujarGrafo('result');
    const inputUsername = document.getElementById('username');
    const inputLimit = document.getElementById('limitNodes');
    const limit = parseInt(inputLimit.value);
    if(inputUsername.value !== '') {
      let datos;
      if(inputLimit.value === ''){
        datos = await getSeguidos(inputUsername.value);
      } else {
        if(limit >= 10 &amp;&amp; limit &lt;= 100) {
          datos = await getSeguidos(inputUsername.value, inputLimit.value);
        } else {
          //Mostrar mensaje no se han obtenido datos
          const mensajeError =  document.querySelector('.limit-error');
          if(mensajeError.style.display === 'none' || mensajeError.style.display === '') {
            mensajeError.style.display = 'block';
            setTimeout(() => {
              mensajeError.style.display = 'none';
            }, 3000);        
          }
          return 
        }
      }
      if(datos === null){
        //Mostrar mensaje no se han obtenido datos
        const mensajeError =  document.querySelector('.fetch-error');
        if(mensajeError.style.display === 'none' || mensajeError.style.display === '') {
          mensajeError.style.display = 'block';
          setTimeout(() => {
            mensajeError.style.display = 'none';
          }, 3000);        
        }
        return 
      }
      owner = datos.owner;
      seguidoresOwner = datos.seguidores;
      llenarNodos(seguidoresOwner);
      llenarAristasAuto();
      const textoGrafo = document.querySelector('.grafo-inicial-text');
      textoGrafo.textContent = 'Grafo Inicial: Seguidos de ' + owner.username;
      //Reiniciar los textos de las complejidades
      const complejidadTextoPrim = document.querySelector('.prim-complejidad');
      complejidadTextoPrim.textContent = 'Aristas * log(Vertices)';
      const complejidadTextoRmc = document.querySelector('.rmc-complejidad');
      complejidadTextoRmc.textContent = 'Vertices * Aristas';
    }
  });
  listenerDibujarGrafo()
}
function listenerDibujarGrafo() {
  dibujoGrafo.graph.on('tap','node', (event) => {
    const target =event.target;
    const nodos = Object.values(grafo.getNodos)
    if(dibujarNodosSeleccionados.length === 0) {
      dibujarNodosSeleccionados.push(target);
      nodosParaRutaMasCorta.push(nodos.find(user => user.valor.username === target.data().id).valor);
      target.style({'background-color': '#ff6d53', 'border-color': 'black'});
    } else {
      if(dibujarNodosSeleccionados[0].data().id === target.data().id) {
        dibujarNodosSeleccionados[0].style({'background-color': '#11aaff', 'border-color': '#88aaff'});
        dibujarNodosSeleccionados.shift();
        nodosParaRutaMasCorta.shift();
        return;    
      } 
      if( dibujarNodosSeleccionados[1]?.data().id === target.data().id) {
        dibujarNodosSeleccionados[1].style({'background-color': '#11aaff', 'border-color': '#88aaff'});
        dibujarNodosSeleccionados.pop();
        nodosParaRutaMasCorta.pop();
        return; 
      } else {
        dibujarNodosSeleccionados.push(target);
        nodosParaRutaMasCorta.push(nodos.find(user => user.valor.username === target.data().id).valor);
        if(dibujarNodosSeleccionados.length > 2){
          dibujarNodosSeleccionados[0].style({'background-color': '#11aaff', 'border-color': '#88aaff'});
          dibujarNodosSeleccionados.shift();
          nodosParaRutaMasCorta.shift();
        }
        target.style({'background-color': '#ff6d53', 'border-color': 'black'});        
      }
    }
  });
}
function pintarAzul() {
  dibujoGrafo.graph.elements().forEach(element => {
    element.style({'background-color': '#11aaff', 'border-color': '#88aaff'});
  })
}

async function getSeguidos(username, limit = 10) {
  //hace fetch para obtener los datos
  const owner = await fetch(`/get-owner/${username}`)
  .then(response => response.json())
  .then(responseJson => responseJson.body.data);
  const seguidores = await fetch(`/get/${username}/${limit}`)
  .then(response => response.json())
  .then(responseJson => responseJson.body.data);
  if(!seguidores || !owner){
    return null;
  }
  return {owner, seguidores};
}

function llenarNodos(listaNodos){
  dibujoGrafo = new DibujarGrafo('graph');
  grafo = new Grafo();
  listenerDibujarGrafo()
  //AÃ±ade los nodos al grafo y los dibuja
  dibujoGrafo.dibujarNodo(owner)
  grafo.agregarNodo(owner)
  listaNodos.forEach(user => {
    dibujoGrafo.dibujarNodo(user)
    grafo.agregarNodo(user)
  })
}

//Generar un numero aleatorio entre un rango [x, y]
function generarNumeroRandom(x,y) {
  return Math.floor(Math.random()*(y-x))+x;
}


function llenarAristasAuto() {
  //genera las aristas no dirigidas
  try {
    let numerosRandom = [];
    //Generar un array de minimo 6 elementos maximo 20 elementos
    let contador;
    let limiteNodos;
    if(document.getElementById('limitNodes').value === '') {
      limiteNodos = 10;
    } else {
      limiteNodos = parseInt(document.getElementById('limitNodes').value);
    }
    // const limiteNodos = 10 /
    //generar Conexxiones Random
    for(contador = 1; contador &lt;= generarNumeroRandom(limiteNodos * 5,limiteNodos * 6); contador++){
      //Generar array con numeros randoms entre el 0 y LÃ­mite MÃ¡ximo
      numerosRandom.push(generarNumeroRandom(0 , limiteNodos+1)); //Al Final
    }
    if(numerosRandom.length%2 != 0){
        //Si el numeros de elementos es impar, eliminamos el Ãºltimo 
        numerosRandom.pop();
    } 
    //Se agrega el owner  a los seguidores
    seguidoresOwner.push(owner);
    for( contador = 0; contador &lt;= numerosRandom.length-1; contador = contador + 2){
      if(grafo.agregarAristaNoDirigida(seguidoresOwner[numerosRandom[contador]], seguidoresOwner[numerosRandom[contador+1]], seguidoresOwner[numerosRandom[contador+1]].public_metrics.followers_count)){
        //Si no existe el vertice y se pudo ingresar correctamente
        aristas++;
        dibujoGrafo.dibujarArista(seguidoresOwner[numerosRandom[contador]], seguidoresOwner[numerosRandom[contador+1]]);
      }
    }
    //Quito el Ãºltimo
    seguidoresOwner.pop();
  } catch (error) {
    console.log(error)
  }
}
function llenarAristas(keysRutaCorta) {
  const dibujoGrafoRMC =  new DibujarGrafo('result');

  keysRutaCorta.forEach(user => {
    /**AÃ±ade la info de los nodos de la ruta mas corta para que se grafique */
    dibujoGrafoRMC.dibujarNodo(user);
  });
  /**Obtiene los nodos desde el grafo general */
  const nodosGrafo = Object.values(grafo.getNodos);

  const datosAgraficar = [];
  keysRutaCorta.forEach(nodo => {
    //obtiene los datos necesarios para la graficaciÃ³n correcta de aristas (username, peso)
    datosAgraficar.push(nodosGrafo.find(node => node.valor.id === nodo.id));
  })

  for(let i = 1; i &lt; datosAgraficar.length; i++) {
    //AÃ±ade las aristas para que se dibujen
    dibujoGrafoRMC.dibujarAristaConPeso(datosAgraficar[i-1].valor, datosAgraficar[i].valor, datosAgraficar[i].distancia - datosAgraficar[i-1].distancia);
  }

}
function llenarAristasPrim(keysPrim) {
  const dibujoGrafoPrim =  new DibujarGrafo('result');
  const keys = Object.keys(keysPrim);

  keys.forEach(key => {
    dibujoGrafoPrim.dibujarNodo(JSON.parse(key));
  });

  const datosAgraficar = {};
  const nodosGrafo = Object.values(grafo.getNodos);
  
  keys.forEach(key => {

    
    const dato = nodosGrafo.find(nodo => nodo.valor.id === JSON.parse(key).id);

    datosAgraficar[JSON.stringify(dato.valor)] = [];
    keysPrim[key].forEach(nodo => {
      
      if(dato.vecinos.map(vecino => vecino[0].valor.id).includes(nodo.id)){
        
        datosAgraficar[JSON.stringify(dato.valor)].push(dato.vecinos.find(vecino => vecino[0].valor.id === nodo.id));
      }
    })
  });

  Object.keys(datosAgraficar).forEach(key => {
    datosAgraficar[key].forEach(nodo => {
      dibujoGrafoPrim.dibujarAristaConPeso(JSON.parse(key), nodo[0].valor, nodo[1]);
    })
  });
}
function rutaMasCorta(origen, destino) {
  //Retorna un string con las keys de los nodos y se almacena en data
  const data = grafo.bellmanFordGrafo(origen, destino);

  return data[0].map(user => JSON.parse(user));//transforma las keys a objetos
}
function arbolExpMin(origen) {
  const resultados = grafo.prim(origen);
  const resultadosJS = resultados.map(resultado => resultado.map(item => JSON.parse(item)));
  const keysUnicas = {};
  resultadosJS.forEach(resultado => {
    //obtengo los nodos diferentes
    if(!Object.keys(keysUnicas).find(key => resultado[0].username === JSON.parse(key)?.username)) {
      keysUnicas[JSON.stringify(resultado[0])] = [];
    }
    if(!Object.keys(keysUnicas).find(key => resultado[1].username === JSON.parse(key)?.username)) {
      keysUnicas[JSON.stringify(resultado[1])] = [];
    }
  });
  Object.keys(keysUnicas).forEach(key => {
    resultadosJS.forEach(resultado => {
      if(resultado[0].username === JSON.parse(key)?.username){
        keysUnicas[key].push(resultado[1]);
      }
    })
  })
  return keysUnicas;
}</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="width: 120px; height: 15px">
    <div class="footer-text">Â© Derechos Reservados 2022 Frankz Alarcon Christian PazmiÃ±o Jonathan Amagua</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
